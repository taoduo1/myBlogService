# 笔记
## 项目说明
此项目架构设计架构为分布式微服务应用，旨在练习微服务使用及技术提升。  
微服务框架使用 spring cloud，数据库使用mongdb，mysql，缓存使用redis，搜索使用es，队列使用kafuka，权限框架使用shiro，  
集合微信公众号，web端，app目前不考虑增加，构建此商城项目，部分功能集成B端工作流（使用Activiti）

1. 项目说明：项目搭建，使用idea 创建springboot项目，创建父子工程，父子工程网上说的很多，但是很多技术文档没有说明关键点。  
首先是夫项目的定义：父子项目搭建首先创建父项目，父项目无所谓什么类型的项目，只是一个载体，在我理解可以将一些子项目的公共maven引用放入父pom中， 以此来简化子项目。
2. 项目创建： 创建父工程，此工程只作为容器使用，不发挥任何功能，所以可以删除src目录和其他无用文件，保留文件时需保留.idea文件夹和.iml文件，
否则创建工程的时候不出来
3. 创建common功能，此项目为工具项目，用以检验项目间代码引用是否正常，创建项目后，需将common项目中的pom的修改为父工程的信息
```html
<parent>
    <groupId>com.example</groupId>
    <artifactId>shop_project</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</parent>
```
4. 子项目创建后，需增加至父项目的pom文件中的model标签中，目前idea不会自动加入model标签，需手动添加：如下
```html
<modules>
    <module>shop_common</module>
    <module>shop_user</module>
</modules>
```
5.如果项目间需要引用，则需将被应用项目的信息添加至需要引用的项目中即可，如下
```html
<dependency>
    <groupId>com.example</groupId>
    <artifactId>shop_common</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <scope>compile</scope>
</dependency>
```
### 用户注册及登录方案  
#### 用户密码生成：
采用md5+随机盐的方式生成，盐值为用户注册ip  
#### 用户登录信息保存：
token+redis  

附：token+redis还是jwt的选择  
看了网上关于很多jwt还是token+redis的争论，整理了一下发下自己的理解  
jwt是去中心化的，只要两个服务，使用相同解密方式，就可以确认用户登录，鉴权等操作，但是由于jwt一旦下发无法撤回的问题，如果用户注销了，需要手动配置黑名单等方法实现用户注销功能
简单的来说，JWT相比传统的token方案最大的优点是验证过程不依赖其他服务。  
token+redis的操作是传统的方案，由专门的服务去获取用户数据，因为比jwt多一次与redis 的IO过程，redis就成了瓶颈，与jwt相比呢，就是好操作，注销直接删除redis中内容就行  
因当前系统是没有很多复杂子系统调用，后续的服务调用也是考虑通过rpc调用用户服务获取用户数据，所以还是采用token+redis的方式

### 用户权限模块设计
权限基础设计为 角色表，资源表，角色资源表，用户角色表，以此为基础进行设计，但是此项目为了以后扩展，还是使用shiro来做权限框架


zk做分布式锁

失败是有流程的
下订单的时候是分步骤的，如果在其中某一个步骤失败了，就把这个数据退到回退流程中去
例如：订单有：支付完成-》创建订单-》创建物流信息-》优惠券失效-》新增积分-》完成后状态生效。这些流程
如果订单在某个流程失败了，比如在新增积分时失败了。
会将这条数据进入回滚流程
优惠券失效恢复-》物流信息删除-》订单删除-》支付金额回退

分布式理论：
将大业务抽分成各个小业集群保证高可用，
增加熔断等措施，保证请求不会被阻塞保证本服务的高可用

### 项目升级为springboot3

### 增加定时任务调用

## 用户注册

## 用户登录